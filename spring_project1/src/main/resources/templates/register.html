<!DOCTYPE html>
<meta charset="utf-8" />
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>會員註冊</title>
   
</head>
<body>
<h2>會員註冊</h2>
<form th:action="@{/register}" method="post" oninput="validateForm()" style="width:300px; font-family:sans-serif;">
    <div style="margin-bottom:10px;">
        <label for="email">Email:</label><br>
        <input type="text" id="email" name="email" th:value="*{email}" placeholder="請輸入Email" required >
        <div id="emailError" style="color:red; font-size:12px;"></div>
    </div>

    <div style="margin-bottom:10px;">
        <label for="passwd">密碼:</label><br>
        <input type="password" id="passwd" name="passwd" th:value="*{passwd}" placeholder="請輸入密碼" required >
        <div id="passwdError" style="color:red; font-size:12px;"></div>
    </div>

    <div style="margin-bottom:10px;">
        <label for="name">姓名:</label><br>
        <input type="text" id="name" name="name" th:value="*{name}" placeholder="請輸入姓名" required >
        <div id="nameError" style="color:red; font-size:12px;"></div>
    </div>

    <button type="submit" id="registerBtn" disabled>註冊</button>
</form>

<p><a th:href="@{/login}">已有帳號？登入</a></p>

<div id="g_id_onload"
			data-client_id="66087248968-3kjfaqub7t6irtu7nuuvojd7oqmu69c8.apps.googleusercontent.com"
			data-context="signin" data-ux_mode="popup"
			data-callback="handleCredentialResponse"></div>

		<div class="g_id_signin" data-type="standard"></div>

<!-- 後端錯誤訊息 -->
<p th:if="${error}" th:text="${error}" style="color:red"></p>

 <script>
        function validateForm() {
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("passwd").value;
            const name = document.getElementById("name").value.trim();
            const registerBtn = document.getElementById("registerBtn");

            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            const passwordValid = /^(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(password);
            const nameValid = name.length > 0;

            // 顯示錯誤提示
            document.getElementById("emailError").textContent = emailValid ? "" : "請輸入有效的 Email";
            document.getElementById("passwdError").textContent = passwordValid ? "" : "密碼需包含大寫、小寫字母且至少8碼";
            document.getElementById("nameError").textContent = nameValid ? "" : "姓名不得為空";

            // 控制按鈕啟用
            registerBtn.disabled = !(emailValid && passwordValid && nameValid);
        }
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
	<script>
        function handleCredentialResponse(response) {
            const id_token = response.credential;
            fetch("/google-login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ idToken: id_token })
            }).then(res => {
                if (res.redirected) {
                    window.location.href = res.url;
                } else {
                    alert("Google 登入失敗！");
                }
            }).catch(err => {
                console.error("Fetch 錯誤:", err);
                alert("登入請求發生錯誤！");
            });
        }
    </script>
</body>
</html>
